# Python Function App to Linux on Azure
# Build a Python function app and deploy it to Azure as a Linux function app.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

variables:
  # Azure Resource Manager connection created during pipeline creation
  azureSubscription: 'faf3322b-2f3f-4938-abf1-050e189c2dbc'

  # Function app name
  functionAppName: 'diego-function'

  # Agent VM image name
  vmImageName: 'ubuntu-latest'

  # Working Directory
  workingDirectory: '$(System.DefaultWorkingDirectory)/'

stages:
- stage: Build
  displayName: Build stage

  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: $(vmImageName)

    steps:
    - task: SqlAzureDacpacDeployment@1
      inputs:
        azureSubscription: 'Azure subscription 1 (d897d75f-01f3-405f-ac55-6525565975a9)'
        AuthenticationType: 'server'
        ServerName: 'dbtest22.database.windows.net:1433'
        DatabaseName: 'dbtest'
        SqlUsername: 'diegoserver'
        SqlPassword: 'HiCifraos2023$'
        deployType: 'SqlTask'
        SqlFile: 'db.sql'
        IpDetectionMethod: 'AutoDetect'


